<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
			   xmlns:s="library://ns.adobe.com/flex/spark"
			   xmlns:cedoassets="cn.com.dhcc.fzep.topo.components.assets.*"
			   xmlns:mx="library://ns.adobe.com/flex/mx"
			   xmlns:services="services.*"
			   minWidth="955" minHeight="600" creationComplete="application1_creationCompleteHandler(event)">
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.graphics.SolidColorStroke;
			
			import spark.components.Label;
			import spark.primitives.Line;
			
			import cn.com.dhcc.fzep.topo.components.assets.SiteContainer;
			
			import valueObjects.Cable;
			
			
			private var OFFSET_Y:Number = 33;
			/**
			 * 连接两个站点的光缆
			 */
			protected function connectCable(site1:SiteContainer, site2:SiteContainer):void{
				var site1Cable:ArrayCollection = new ArrayCollection(site1.cableList);
				var site2Cable:ArrayCollection = new ArrayCollection(site2.cableList);
				for (var i:int = 0; i < site1Cable.length; i++) 
				{
					var cable1:Cable = site1Cable.getItemAt(i) as Cable;
					for (var j:int = 0; j < site2Cable.length; j++) 
					{
						var cable2:Cable = site2Cable.getItemAt(i) as Cable;
						if(cable1.cableId == cable2.cableId){
							//Alert.show(cable1.cableId);
							var strokes:SolidColorStroke = site1.cableStroke(cable1.cableId);// new SolidColorStroke();
							
							var pointS:Point = site1.connectionToCable(cable1.cableId);
							var pointE:Point = site2.connectionToCable(cable2.cableId);
							var offsetY:Number = (i%2==0?-OFFSET_Y:OFFSET_Y);
							
							var line:Line = new Line();
							line.xFrom = pointS.x + lSitePCon.x;
							line.yFrom = pointS.y + lSitePCon.y + offsetY;
							line.xTo =  pointE.x + lSite2PCon.x ;
							line.yTo = pointE.y + lSite2PCon.y + offsetY;
							line.stroke = strokes;
							container.addElement(line);
							
							
							var cableInfo:Label = new Label();
							cableInfo.text = cable1.cableName;
							cableInfo.width = 100;
							cableInfo.height = 25;
							cableInfo.setStyle("fontSize", 12);
							
							cableInfo.x = (line.xTo + line.xFrom)/2;// - cableInfo.width/2;
							cableInfo.buttonMode = true;
							cableInfo.y = (line.yTo + line.yFrom)/2 - 6;
							container.addElement(cableInfo);
							
							
							var line2:Line = new Line();
							line2.xFrom = pointS.x + lSitePCon.x;
							line2.yFrom = pointS.y + lSitePCon.y + offsetY;
							line2.xTo =  pointS.x + lSitePCon.x ;
							line2.yTo = pointS.y + lSitePCon.y ;
							line2.stroke = strokes;
							container.addElement(line2);
							
							var line3:Line = new Line();
							line3.xFrom = pointE.x + lSite2PCon.x;
							line3.yFrom = pointE.y + lSite2PCon.y;
							line3.xTo =  pointE.x + lSite2PCon.x ;
							line3.yTo = pointE.y + lSite2PCon.y + offsetY ;
							line3.stroke = strokes;
							container.addElement(line3);
							
							break;
						}else{
							continue;
						}
						
					}
					
				}
				
			}
			
			protected function application1_creationCompleteHandler(event:FlexEvent):void
			{
				lSiteCon.siteId = "1";
				lSiteCon.endCallback = connectSite;
				
				lSiteCon2.siteId = "2";
				lSiteCon2.endCallback = connectSite;
				
			}
			
			public function connectSite():void{
				
				connectCable(lSiteCon, lSiteCon2);
			}
		]]>
	</fx:Script>
	<!--
	<mx:ApplicationControlBar>
		<s:Label text="DEMO-仅作展示使用" >
		</s:Label>
	</mx:ApplicationControlBar>
	-->
	<s:Panel title="福州电业局资产关系示意图"
			 width="90%" height="90%" horizontalCenter="0" verticalCenter="0">
		<s:BorderContainer y="60" width="100%" height="66%" verticalCenter="middle"  borderVisible="false">
			<s:layout>
				<s:HorizontalLayout  paddingBottom="10" paddingLeft="10" paddingRight="10" paddingTop="10" />
			</s:layout>
			<s:BorderContainer   width="100%" height="100%" verticalCenter="middle" id="container" borderVisible="false"  >
				<s:BorderContainer width="45%" height="400" verticalCenter="middle" id="lSitePCon"  borderVisible="false"  cornerRadius="10" >
					<cedoassets:SiteContainer id="lSiteCon" ></cedoassets:SiteContainer>
				</s:BorderContainer>
				<s:BorderContainer width="45%" x="{lSitePCon.width+50}" height="400" id="lSite2PCon" verticalCenter="middle"  borderVisible="false"  cornerRadius="10" >
					<cedoassets:SiteContainer id="lSiteCon2" ></cedoassets:SiteContainer>
				</s:BorderContainer>
			</s:BorderContainer>
		</s:BorderContainer>
	</s:Panel>
</s:Application>
